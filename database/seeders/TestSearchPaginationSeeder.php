<?php

namespace Database\Seeders;

use Illuminate\Database\Seeder;
use App\Models\Project;
use App\Models\ProjectStage;
use App\Models\StageTask;
use Carbon\Carbon;

class TestSearchPaginationSeeder extends Seeder
{
    /**
     * Run the database seeds.
     */
    public function run(): void
    {
        $user = \App\Models\User::find(1);
        
        if (!$user) {
            $this->command->error('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å ID 1 –Ω–µ –Ω–∞–π–¥–µ–Ω!');
            return;
        }

        // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç
        $project = Project::create([
            'user_id' => 1,
            'name' => '–¢–µ—Å—Ç–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞ –∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏',
            'address' => '–≥. –ú–æ—Å–∫–≤–∞, —É–ª. –¢–µ—Å—Ç–æ–≤–∞—è, –¥. 1',
            'work_type' => '–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π —Ä–µ–º–æ–Ω—Ç',
            'status' => '–í —Ä–∞–±–æ—Ç–µ',
            'markup_percent' => 20,
        ]);

        // –°–æ–∑–¥–∞–µ–º —Ä–æ–ª—å –≤–ª–∞–¥–µ–ª—å—Ü–∞
        \App\Models\ProjectUserRole::create([
            'project_id' => $project->id,
            'user_id' => 1,
            'role' => 'owner',
            ...(\App\Models\ProjectUserRole::getDefaultPermissions('owner'))
        ]);

        $this->command->info('–°–æ–∑–¥–∞–Ω –ø—Ä–æ–µ–∫—Ç: ' . $project->name . ' (ID: ' . $project->id . ')');
        $this->command->info('');

        // –°–æ–∑–¥–∞–µ–º 20 —ç—Ç–∞–ø–æ–≤
        $stageNames = [
            '–î–µ–º–æ–Ω—Ç–∞–∂–Ω—ã–µ —Ä–∞–±–æ—Ç—ã',
            '–≠–ª–µ–∫—Ç—Ä–æ–º–æ–Ω—Ç–∞–∂–Ω—ã–µ —Ä–∞–±–æ—Ç—ã',
            '–°–∞–Ω—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã',
            '–®—Ç—É–∫–∞—Ç—É—Ä–Ω—ã–µ —Ä–∞–±–æ—Ç—ã',
            '–ú–∞–ª—è—Ä–Ω—ã–µ —Ä–∞–±–æ—Ç—ã',
            '–£–∫–ª–∞–¥–∫–∞ –ø–ª–∏—Ç–∫–∏',
            '–ú–æ–Ω—Ç–∞–∂ –≥–∏–ø—Å–æ–∫–∞—Ä—Ç–æ–Ω–∞',
            '–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–æ–ª–æ–≤',
            '–ú–æ–Ω—Ç–∞–∂ –Ω–∞—Ç—è–∂–Ω—ã—Ö –ø–æ—Ç–æ–ª–∫–æ–≤',
            '–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–≤–µ—Ä–µ–π',
            '–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–∫–æ–Ω',
            '–ú–æ–Ω—Ç–∞–∂ –∫—É—Ö–Ω–∏',
            '–ú–æ–Ω—Ç–∞–∂ —Å–∞–Ω—Ç–µ—Ö–Ω–∏–∫–∏',
            '–ú–æ–Ω—Ç–∞–∂ –æ—Å–≤–µ—â–µ–Ω–∏—è',
            '–£–∫–ª–∞–¥–∫–∞ –ª–∞–º–∏–Ω–∞—Ç–∞',
            '–£–∫–ª–∞–¥–∫–∞ –ø–∞—Ä–∫–µ—Ç–∞',
            '–ü–æ–∫—Ä–∞—Å–∫–∞ —Å—Ç–µ–Ω',
            '–ü–æ–∫–ª–µ–π–∫–∞ –æ–±–æ–µ–≤',
            '–ú–æ–Ω—Ç–∞–∂ –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–π –º–µ–±–µ–ª–∏',
            '–§–∏–Ω–∞–ª—å–Ω–∞—è —É–±–æ—Ä–∫–∞',
        ];

        $startDate = Carbon::now();

        foreach ($stageNames as $index => $stageName) {
            $endDate = $startDate->copy()->addDays(rand(7, 21));
            
            $stage = ProjectStage::create([
                'project_id' => $project->id,
                'name' => $stageName,
                'start_date' => $startDate->format('Y-m-d'),
                'end_date' => $endDate->format('Y-m-d'),
                'order' => $index,
                'status' => ['–ù–µ –Ω–∞—á–∞—Ç', '–í —Ä–∞–±–æ—Ç–µ', '–ì–æ—Ç–æ–≤–æ'][rand(0, 2)],
            ]);

            $stageNumber = $index + 1;
            $this->command->info("–°–æ–∑–¥–∞–Ω —ç—Ç–∞–ø #{$stageNumber}: {$stageName}");

            // –î–ª—è —Ç—Ä–µ—Ç—å–µ–≥–æ —ç—Ç–∞–ø–∞ —Å–æ–∑–¥–∞–µ–º 50 –∑–∞–¥–∞—á (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–∏—Å–∫–∞ –∑–∞–¥–∞—á)
            if ($index === 2) {
                $taskNames = [
                    '–ü—Ä–æ–∫–ª–∞–¥–∫–∞ —Ç—Ä—É–± —Ö–æ–ª–æ–¥–Ω–æ–π –≤–æ–¥—ã',
                    '–ü—Ä–æ–∫–ª–∞–¥–∫–∞ —Ç—Ä—É–± –≥–æ—Ä—è—á–µ–π –≤–æ–¥—ã',
                    '–ü—Ä–æ–∫–ª–∞–¥–∫–∞ –∫–∞–Ω–∞–ª–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç—Ä—É–±',
                    '–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–ª–ª–µ–∫—Ç–æ—Ä–∞',
                    '–ú–æ–Ω—Ç–∞–∂ –≤–æ–¥—è–Ω—ã—Ö —Ä–æ–∑–µ—Ç–æ–∫',
                    '–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å—á–µ—Ç—á–∏–∫–æ–≤ –≤–æ–¥—ã',
                    '–ú–æ–Ω—Ç–∞–∂ —Ñ–∏–ª—å—Ç—Ä–æ–≤',
                    '–ü—Ä–æ–∫–ª–∞–¥–∫–∞ —Ç—Ä—É–± –æ—Ç–æ–ø–ª–µ–Ω–∏—è',
                    '–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–∞–¥–∏–∞—Ç–æ—Ä–æ–≤',
                    '–ú–æ–Ω—Ç–∞–∂ —Ç–µ–ø–ª–æ–≥–æ –ø–æ–ª–∞',
                    '–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–ª–æ—Ç–µ–Ω—Ü–µ—Å—É—à–∏—Ç–µ–ª—è',
                    '–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–º–µ—Å–∏—Ç–µ–ª–µ–π',
                    '–ú–æ–Ω—Ç–∞–∂ —Ä–∞–∫–æ–≤–∏–Ω—ã',
                    '–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —É–Ω–∏—Ç–∞–∑–∞',
                    '–ú–æ–Ω—Ç–∞–∂ –≤–∞–Ω–Ω—ã',
                    '–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥—É—à–µ–≤–æ–π –∫–∞–±–∏–Ω—ã',
                    '–ú–æ–Ω—Ç–∞–∂ –±–∏–¥–µ',
                    '–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∏—Å—Å—É–∞—Ä–∞',
                    '–ú–æ–Ω—Ç–∞–∂ –∫—É—Ö–æ–Ω–Ω–æ–π –º–æ–π–∫–∏',
                    '–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ—Å—É–¥–æ–º–æ–µ—á–Ω–æ–π –º–∞—à–∏–Ω—ã',
                    '–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç–∏—Ä–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã',
                    '–ú–æ–Ω—Ç–∞–∂ –±–æ–π–ª–µ—Ä–∞',
                    '–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤–æ–¥–æ–Ω–∞–≥—Ä–µ–≤–∞—Ç–µ–ª—è',
                    '–ü—Ä–æ–∫–ª–∞–¥–∫–∞ –¥—Ä–µ–Ω–∞–∂–∞',
                    '–ú–æ–Ω—Ç–∞–∂ –Ω–∞—Å–æ—Å–Ω–æ–π —Å—Ç–∞–Ω—Ü–∏–∏',
                    '–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≥–∏–¥—Ä–æ–∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä–∞',
                    '–ú–æ–Ω—Ç–∞–∂ –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –∫–ª–∞–ø–∞–Ω–∞',
                    '–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–µ–¥—É–∫—Ç–æ—Ä–∞ –¥–∞–≤–ª–µ–Ω–∏—è',
                    '–ú–æ–Ω—Ç–∞–∂ –∑–∞–ø–æ—Ä–Ω–æ–π –∞—Ä–º–∞—Ç—É—Ä—ã',
                    '–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∏—Ñ–æ–Ω–æ–≤',
                    '–ú–æ–Ω—Ç–∞–∂ –≥–æ—Ñ—Ä—ã',
                    '–ü—Ä–æ–∫–ª–∞–¥–∫–∞ –∫–∞–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–ª—è —Å—Ç–∏—Ä–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã',
                    '–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ñ–∞–Ω–æ–≤–æ–π —Ç—Ä—É–±—ã',
                    '–ú–æ–Ω—Ç–∞–∂ –≤–µ–Ω—Ç–∏–ª—è—Ü–∏–æ–Ω–Ω–æ–≥–æ –∫–ª–∞–ø–∞–Ω–∞',
                    '–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∞—ç—Ä–∞—Ç–æ—Ä–∞',
                    '–ú–æ–Ω—Ç–∞–∂ —Ç—Ä–æ–π–Ω–∏–∫–æ–≤',
                    '–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–Ω–∏–∫–æ–≤',
                    '–ü—Ä–æ–∫–ª–∞–¥–∫–∞ —Ç—Ä—É–±—ã –¥–ª—è –ø–æ—Å—É–¥–æ–º–æ–π–∫–∏',
                    '–ú–æ–Ω—Ç–∞–∂ –∏–∑–º–µ–ª—å—á–∏—Ç–µ–ª—è –æ—Ç—Ö–æ–¥–æ–≤',
                    '–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∞–≤–∞—Ä–∏–π–Ω–æ–≥–æ —Å–ª–∏–≤–∞',
                    '–ú–æ–Ω—Ç–∞–∂ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–ª–∏–≤–∞',
                    '–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º—ã –æ—á–∏—Å—Ç–∫–∏ –≤–æ–¥—ã',
                    '–ú–æ–Ω—Ç–∞–∂ –£–§-—Ñ–∏–ª—å—Ç—Ä–∞',
                    '–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–∞—Ä—Ç—Ä–∏–¥–∂–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤',
                    '–ú–æ–Ω—Ç–∞–∂ —Å–∏—Å—Ç–µ–º—ã —É–º—è–≥—á–µ–Ω–∏—è –≤–æ–¥—ã',
                    '–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–±–µ–∑–∂–µ–ª–µ–∑–∏–≤–∞—Ç–µ–ª—è',
                    '–ü—Ä–æ–∫–ª–∞–¥–∫–∞ —Ç—Ä—É–±—ã –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞',
                    '–ú–æ–Ω—Ç–∞–∂ –∫—Ä–∞–Ω–∞ –ø–∏—Ç—å–µ–≤–æ–π –≤–æ–¥—ã',
                    '–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ—Ä–º–æ—Å—Ç–∞—Ç–∞',
                    '–§–∏–Ω–∞–ª—å–Ω–∞—è –æ–ø—Ä–µ—Å—Å–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º—ã',
                ];

                foreach ($taskNames as $taskIndex => $taskName) {
                    StageTask::create([
                        'stage_id' => $stage->id,
                        'name' => $taskName,
                        'description' => "–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏: {$taskName}. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ –∏ –≤ —Å—Ä–æ–∫.",
                        'status' => ['–ù–µ –Ω–∞—á–∞—Ç–∞', '–í —Ä–∞–±–æ—Ç–µ', '–ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ', '–ó–∞–≤–µ—Ä—à–µ–Ω–∞'][rand(0, 3)],
                        'cost' => rand(1000, 50000),
                        'markup_percent' => rand(10, 30),
                        'order' => $taskIndex,
                        'created_by' => 1,
                        'assigned_to' => rand(0, 1) ? 1 : null,
                    ]);
                }

                $this->command->info("  ‚îî‚îÄ –°–æ–∑–¥–∞–Ω–æ 50 –∑–∞–¥–∞—á –¥–ª—è —ç—Ç–æ–≥–æ —ç—Ç–∞–ø–∞");
            } else {
                // –î–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —ç—Ç–∞–ø–æ–≤ —Å–æ–∑–¥–∞–µ–º 3-7 –∑–∞–¥–∞—á
                $taskCount = rand(3, 7);
                for ($i = 0; $i < $taskCount; $i++) {
                    $taskNumber = $i + 1;
                    StageTask::create([
                        'stage_id' => $stage->id,
                        'name' => "–ó–∞–¥–∞—á–∞ {$taskNumber} –¥–ª—è —ç—Ç–∞–ø–∞ '{$stageName}'",
                        'description' => "–û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ {$taskNumber}",
                        'status' => ['–ù–µ –Ω–∞—á–∞—Ç–∞', '–í —Ä–∞–±–æ—Ç–µ', '–ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ', '–ó–∞–≤–µ—Ä—à–µ–Ω–∞'][rand(0, 3)],
                        'cost' => rand(5000, 30000),
                        'markup_percent' => rand(10, 25),
                        'order' => $i,
                        'created_by' => 1,
                        'assigned_to' => rand(0, 1) ? 1 : null,
                    ]);
                }

                $this->command->info("  ‚îî‚îÄ –°–æ–∑–¥–∞–Ω–æ {$taskCount} –∑–∞–¥–∞—á");
            }

            $startDate = $endDate->addDay();
        }

        $this->command->info('');
        $this->command->info('‚úÖ –ì–æ—Ç–æ–≤–æ!');
        $this->command->info("üìä –°–æ–∑–¥–∞–Ω –ø—Ä–æ–µ–∫—Ç ID: {$project->id}");
        $this->command->info("üìã –°–æ–∑–¥–∞–Ω–æ: 20 —ç—Ç–∞–ø–æ–≤ –∏ ~130 –∑–∞–¥–∞—á");
        $this->command->info("üîç –¢—Ä–µ—Ç–∏–π —ç—Ç–∞–ø '–°–∞–Ω—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã' —Å–æ–¥–µ—Ä–∂–∏—Ç 50 –∑–∞–¥–∞—á");
        $this->command->info("üìÑ –í—Å–µ–≥–æ —ç—Ç–∞–ø–æ–≤ > 15 - –ø–æ–∏—Å–∫–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞ –ø–æ—è–≤–∏—Ç—Å—è");
        $this->command->info("üîó –û—Ç–∫—Ä–æ–π—Ç–µ: /projects/{$project->id}");
    }
}
